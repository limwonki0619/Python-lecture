
# **기본 인덱싱 정리**

### **열 인덱싱**

- `df['열1']` : 하나의 열을 **시리즈**로 반환 
- `df[['열1, 열2']]` : 둘 이상의 열을 **데이터프레임**으로 반환
- `df[['열1']]` : 하나의 열을 **데이터프레임**으로 반환 
- `df[(숫자) 열1]` : 열 인덱스가 **원래 숫자**인 경우여야 가능하며, **시리즈**로 반환
- `df[[(숫자) 열1, (숫자)열2]]` : 열 인덱스가 **원래 숫자**인 경우여야 가능하며, **데이터프레임**으로 반환 

<br>

### **행 인덱싱**

행 인덱싱은 항상 **슬라이싱**으로 사용한다. 또한 행 인덱스 값이 **문자 라벨**인 경우, **라벨 슬라이싱**도 가능하다.

- `df[:1]` : 첫번쨰 행 반환 
- `df[1:2]` : 두번째 행 반환
- `df[1:3]` : 두 세번째 행 반환
- `df['문자 라벨1', '문자 라벨2']` : 라벨1부터 라벨2까지 포함하는 행 반환 

<br>

### **개별 인덱싱**

기본적인 데이터프레임 인덱싱은 
`df[열][행]` 으로 이루어진다. 결과값은 스칼라 값으로 출력된다.

<br>

# **고급 인덱싱 정리**

### **`loc` 인덱서** 

- 인덱스 값으로 `문자 라벨`을 받는다.
- `df.loc[행]`
- `df.loc[행, 열]`

인덱싱 값으로 사용가능한 것은 다음과 같다.

- 인덱스데이터
- 인덱스데이터 슬라이스
- 인덱스데이터 리스트
- 같은 행 인덱스를 가지는 불리언 시리즈 (행 인덱싱의 경우)
- 또는 위의 값들을 반환하는 함수

<br>

### **`iloc` 인덱서**

- 인덱스 값으로 `정수(숫자)`을 받는다.
- 나머지는 `loc`인덱서와 동일하다.

<br>

# **기본 인덱싱 vs 고급 인덱싱**

### **기본 인덱싱의 경우**

`df[열]` : 인덱스 값이 하나만 입력되는 경우 **열**을 반환한다.  

`df[열][행]`으로 인덱싱이 이뤄진다.  

 `행` 을 인덱싱 하고자 할 경우 항상 **슬라이싱**을 사용해야 한다. 

<br>

### **고급 인덱싱의 경우**

`df.loc[행]` : 인덱스 값이 하나만 입력되는 경우 **행**을 반환한다.   

`df.loc[행, 열]`로 인덱싱이 이뤄진다.

`열`을 인덱싱 하고자 할 경우 `:` 등을 행 인덱스 자리에 입력 한 후 원하는 열을 인덱싱 한다.

<br>

# **데이터프레임 병합 정리**

<br>

## **1. `merge`를 이용한 병합**

`merge` 명령은 두 데이터 프레임의 공통 열 혹은 인덱스를 기준으로 두 개의 테이블을 합친다. 이 때 기준이 되는 열, 행의 데이터를 **키(key)**라고 한다.

`pd.merge(df1, df2)` : 같은 이름의 공통 열이 있을 경우, 디폴트는 inner join 

`pd.merge(df1, df2, how='outer` : outer join은 키 값이 한쪽에만 있어도 데이터를 보여준다.

`left join`의 경우 첫번째 데이터프레임의 키 값을 모두 보여준다.

`right join`의 경우 두번째 데이터프레임의 키 값을 모두 보여준다.

한편, 두 데이터 프레임에서 이름이 같은 열은 모두 **키(Key)**가 된다.  따라서 같은 이름의 열이 두 개 이상인 경우, `키`로 설정하고자 하는 열을`on`인수로 선택해줘야 한다.

반대로 두개의 데이터프레임에서 키로 사용하고자 하는 열 이름이 서로 다르다면, `left_on` 인수와, `right_on`인수를 사용해 각각의 데이터프렘에서 어떤 열을 키로 사용할지 선택해줘야 한다. 

또한 일반 데이터 열이 아닌 인덱스(행)을 사용하려면 `left_index` 또는 `right_index`인수를 `True`로 설정한다. 

<br>

## **2. `concat`를 이용한 데이터 연결**

`concat` 명령을 사용하면 기준 열(key column)을 사용하지 않고 단순히 데이터를 연결(concatenate)한다.

- `pd.concat([df1, df2])`

기본적으로는 위/아래로 데이터 행을 연결(디폴트는 axis = 0)한다. 단순히 두 시리즈나 데이터프레임을 연결하기 때문에 인덱스 값이 중복될 수 있다. ( rbind와 유사)

- `pd.concat([df1, df2], axis=1)`

만약 옆으로 데이터 열을 연결하고자하면 `axis = 1`로 인수를 설정한다. 

<br>

# **피봇테이블과 그룹분석 정리**

피봇테이블(pivot table)이란 데이터 열 중에서 두 개의 열을 각각 행 인덱스, 열 인덱스로 사용하여 데이터를 조회하여 펼쳐놓은 것을 말한다.

행 인덱스와 열 인덱스는 **데이터를 찾는 키(key)**의 역할을 한다. 따라서 키 값으로 데이터가 **단 하나만 찾아져야 한다.** 만약 행 인덱스와 열 인덱스 조건을 만족하는 데이터가 2개 이상인 경우에는 에러가 발생한다.

<br>

## **1. `groupby`  메서드**

`groupby` 메서드는 데이터를 그룹 별로 분류하는 역할을 한다. `groupby` 메서드의 인수로는 다음과 같은 값을 사용한다.

-   열 또는 열의 리스트
-   행 인덱스

연산 결과로 그룹 데이터를 나타내는 `GroupBy` 클래스 객체를 반환한다. 이 객체에는 그룹별로 연산을 할 수 있는 그룹연산 메서드가 있다.

<br>

### **1.1 그룹연산 메서드**

`groupby` 결과, 즉 `GroupBy` 클래스 객체의 뒤에 붙일 수 있는 그룹연산 메서드는 다양하다. 다음은 자주 사용되는 그룹연산 메서드들이다.

-   `size`,  `count`: 그룹 데이터의 갯수
-   `mean`,  `median`,  `min`,  `max`: 그룹 데이터의 평균, 중앙값, 최소, 최대
-   `sum`,  `prod`,  `std`,  `var`,  `quantile`  : 그룹 데이터의 합계, 곱, 표준편차, 분산, 사분위수
-   `first`,  `last`: 그룹 데이터 중 가장 첫번째 데이터와 가장 나중 데이터
-   `agg`,  `aggregate`
    
    -   만약 원하는 그룹연산이 없는 경우 함수를 만들고 이 함수를  `agg`에 전달한다.
    -   또는 여러가지 그룹연산을 동시에 하고 싶은 경우 함수 이름 문자열의 리스트를 전달한다.
-   `describe`
    
    -   하나의 그룹 대표값이 아니라 여러개의 값을 데이터프레임으로 구한다.
-   `apply`
    
    -   `describe`  처럼 하나의 대표값이 아닌 데이터프레임을 출력하지만 원하는 그룹연산이 없는 경우에 사용한다.
-   `transform`
    
    -   그룹에 대한 대표값을 만드는 것이 아니라 그룹별 계산을 통해 데이터 자체를 변형한다.

<br>

## **2. `Pivot_table`**

Pandas는 `pivot` 명령과 `groupby` 명령의 중간 성격을 가지는 `pivot_table` 명령도 제공한다.

`groupby` 명령의 결과에 `unstack`을 자동 적용하여 2차원적인 형태로 변형한다. 사용 방법은 다음과 같다.

- `pivot_table(data, values=None, index=None, columns=None, aggfunc='mean', fill_value=None, margins=False, margins_name='All')`
- 메서드로 사용할 경우,  객체 자체가 데이터가 된다. 따라서 **`pivot_table[값, 행, 열]`**로 사용할 수 있다. 

-   `data`: 분석할 데이터프레임 (메서드일 때는 필요하지 않음)
-   `values`: 분석할 데이터프레임에서 분석할 열
-   `index`: 행 인덱스로 들어갈 키 열 또는 키 열의 리스트
-   `columns`: 열 인덱스로 들어갈 키 열 또는 키 열의 리스트
-   `aggfunc`: 분석 메서드
-   `fill_value`: NaN 대체 값
-   `margins`: 모든 데이터를 분석한 결과를 오른쪽과 아래에 붙일지 여부
-   `margins_name`: 마진 열(행)의 이름
만약 조건에 따른 데이터가 유일하게 선택되지 않으면 그룹연산을 하며 이 때  `aggfunc`  인수로 정의된 함수를 수행하여 대표값을 계산한다.
